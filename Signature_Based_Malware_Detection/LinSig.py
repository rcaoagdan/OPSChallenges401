#!/usr/bin/evn python3

##############################################################################
# Information
##############################################################################

# Linux Functions to be called upon for Signature Based Malware Detection

##############################################################################
# Import Library
##############################################################################
import os,sys,subprocess
from os import path
import hashlib
from datetime import datetime
import logging
import demo
import SigBased
##############################################################################
# Functions
##############################################################################
def LinMain():
    print("*" * 75)
    print("O/S Linux: Signature Based Malware Detection \n")
    print("1.Search for file")
    print("2.Look into a directory:")
    print("3.VirusTotal")
    print("4.Exit")
    LinOPT = input("What would you like to do? ")

    if(LinOPT == "1"):
        LinFileSearch()
    elif(LinOPT == "2"):
        Lin_Hash()
    elif(LinOPT == "3"):
        Lin_Virustotal()
    elif(LinOPT == "4"):
        SigBased.sigExit()
    else:
        print("Invalid Selection")


def LinFileSearch():
   filename = input("Please Enter a File to Search For:")
   path = input( "Please Enter a Directory:")
    
    
   print("*" * 50)
   print("Looking for files named:" + filename + "\n")

   for root, dirs, files in os.walk(path):
        if filename in files:
            print("File FOUND")
            print(os.path.join(root,filename))

   LinMain()

def Lin_Hash():
    print("*" * 75)
    print("Linux Hash Files")
    directory = input("Enter a directory: ")

    for file in os.listdir(directory):
        print(file)
        logging.info("Listed contents of directory: " + directory)
    print("*" * 75)
    print("Now checking MD5 hash values")

    for root, dirs, files in os.walk(directory):
        for file in files:
            FileName = (os.path.join(root,file))
            fileHash = hashlib.md5()
            fSize = os.path.getsize(FileName)
            with open(str(FileName),"rb") as hFiles:
                hashedFiles = hFiles.read()
                fileHash.update(hashedFiles)
            print(str(datetime.now()) + " | " + str(FileName) + " | " + str(fSize) + " bytes" + " | " + str(fileHash.hexdigest()))
            logging.info("Hashed values of " + directory + " printed out.")
    LinMain()

def Lin_Virustotal():
    print("*" * 75)
    print("Window Hash Files -- Virustotal")
    apikey = ('31554f7e856c88b4def8466266bb23a82003383109880e751b8d856b4ef866f6')
    hash = input("Enter a hash to check: ")
    query = 'python3 virustotal-search.py -k ' + str(apikey) + ' -m ' + hash 
    os.system(query)
    LinMain()
   
  
